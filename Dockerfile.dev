# Development Dockerfile for Family Serve Delicious MCP Server
FROM node:22-alpine

WORKDIR /app

COPY package*.json ./
COPY tsconfig.json ./
COPY .npmrc* ./

ARG GITHUB_TOKEN

RUN echo "üîß Setting up GitHub npm authentication..." && \
    if [ -n "$GITHUB_TOKEN" ]; then \
        echo "üìù Using GITHUB_TOKEN from build argument"; \
        echo "@axyor:registry=https://npm.pkg.github.com" > .npmrc; \
        echo "//npm.pkg.github.com/:_authToken=$GITHUB_TOKEN" >> .npmrc; \
    elif [ -f ".npmrc" ]; then \
        echo "üìù Using existing .npmrc file"; \
    else \
        echo "‚ùå No authentication method found!"; \
        echo "Please set GITHUB_TOKEN in .env file"; \
        exit 1; \
    fi

RUN npm install

RUN rm -f .npmrc

COPY src/ ./src/
COPY config/ ./config/

EXPOSE 3000

CMD ["sh", "-c", "npm run build && npm start"]